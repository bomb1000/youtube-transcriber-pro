<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Transcriber Pro - AI 智能逐字稿生成器</title>
    <meta name="description" content="使用 AI 技術自動生成 YouTube 影片逐字稿，支援講者識別與智能修正">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Background Effects -->
    <div class="bg-gradient"></div>
    <div class="bg-gradient-2"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                    <rect width="40" height="40" rx="12" fill="url(#gradient)" />
                    <path d="M12 13L20 20L12 27V13Z" fill="white" />
                    <path d="M20 13L28 20L20 27V13Z" fill="white" opacity="0.6" />
                    <defs>
                        <linearGradient id="gradient" x1="0" y1="0" x2="40" y2="40">
                            <stop stop-color="#6366F1" />
                            <stop offset="1" stop-color="#8B5CF6" />
                        </linearGradient>
                    </defs>
                </svg>
                <h1>YouTube Transcriber Pro</h1>
            </div>
            <button class="settings-btn" id="settingsBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="12" cy="12" r="3" />
                    <path
                        d="M12 1v6m0 6v6m8.66-15.66l-4.24 4.24m-4.24 4.24l-4.24 4.24M23 12h-6m-6 0H1m15.66 8.66l-4.24-4.24m-4.24-4.24l-4.24-4.24" />
                </svg>
            </button>
        </header>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>API 設定</h2>
                    <button class="close-btn" id="closeSettings">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>選擇 STT 服務</label>
                        <select id="sttProvider" class="input">
                            <option value="openai-whisper">🏆 OpenAI Whisper（穩定 + SRT，無講者分離）</option>
                            <option value="gemini">⭐ Google Gemini（免費 + 講者分離）</option>
                            <option value="assemblyai">🎯 AssemblyAI（精準講者分離 + 無限制）</option>
                            <option value="openai-gpt4o">OpenAI GPT-4o（中英混雜最強，無講者）</option>
                            <option value="openai-gpt4o-diarize">🧪 GPT-4o Diarize（Beta）</option>
                            <option value="openai-gpt4o-mini">OpenAI GPT-4o Mini（便宜）</option>
                        </select>
                        <small id="sttHint" class="stt-hint">
                            🎯 最適合：穩定轉錄 + SRT 字幕（無講者分離）
                        </small>
                    </div>

                    <div class="form-group">
                        <label>🔄 繁簡轉換</label>
                        <select id="chineseConversion" class="input">
                            <option value="none">不轉換（保持原樣）</option>
                            <option value="s2t">簡體 → 繁體</option>
                            <option value="t2s">繁體 → 簡體</option>
                        </select>
                        <small>轉錄完成後自動轉換字體</small>
                    </div>

                    <div class="form-group" id="openaiKeyGroup">
                        <label>OpenAI API Key</label>
                        <input type="password" id="openaiKey" class="input" placeholder="sk-...">
                        <small>用於語音轉文字和智能修正</small>
                    </div>

                    <div class="form-group" id="geminiKeyGroup" style="display: none;">
                        <label>Gemini API Key</label>
                        <input type="password" id="geminiKey" class="input" placeholder="AI...">
                        <small>用於語音轉文字</small>
                    </div>

                    <div class="form-group" id="assemblyKeyGroup" style="display: none;">
                        <label>AssemblyAI API Key</label>
                        <input type="password" id="assemblyKey" class="input" placeholder="...">
                        <small>用於語音轉文字（無檔案限制 + 支援無限講者）</small>
                    </div>

                    <div class="form-group">
                        <label>AI 修正服務</label>
                        <select id="correctionProvider" class="input">
                            <option value="gemini">Google Gemini (推薦 - 免費額度高)</option>
                            <option value="openai">OpenAI GPT-4</option>
                        </select>
                    </div>

                    <div class="form-group" id="geminiCorrectionKeyGroup">
                        <label>Gemini API Key (修正用)</label>
                        <input type="password" id="geminiCorrectionKey" class="input" placeholder="AI...">
                        <small>用於智能修正逐字稿</small>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableCorrection" checked>
                            <span>啟用 AI 智能修正</span>
                        </label>
                        <small>自動修正錯別字、標點符號和語句流暢度</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="saveSettings">儲存設定</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Step 1: Input -->
            <section class="card" id="inputSection">
                <div class="card-header">
                    <div class="step-badge">步驟 1</div>
                    <h2>輸入 YouTube 連結</h2>
                </div>
                <div class="card-body">
                    <div class="input-group">
                        <input type="text" id="youtubeUrl" class="input input-large"
                            placeholder="貼上 YouTube 影片連結（包括非公開連結）...">
                        <button class="btn btn-primary" id="startBtn">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M6 4l10 6-10 6V4z" />
                            </svg>
                            開始轉錄
                        </button>
                    </div>
                    <details class="cookies-details">
                        <summary>進階：需要登入時貼上 YouTube cookies（選填）</summary>
                        <div class="cookies-content">
                            <label class="cookies-label" for="cookiesMode">Cookies 輸入方式</label>
                            <select id="cookiesMode" class="input cookies-select">
                                <option value="text" selected>貼上 cookies.txt 內容</option>
                                <option value="base64">貼上 Base64（cookies.txt 轉碼）</option>
                                <option value="browser">使用伺服器瀏覽器設定檔</option>
                            </select>
                            <div class="cookies-field" data-cookies-field="text">
                                <textarea id="cookiesInput" class="input cookies-textarea" rows="6"
                                    placeholder="貼上從瀏覽器匯出的 cookies.txt 內容（僅用於本次下載）"></textarea>
                                <small>若影片要求登入或遇到「Sign in to confirm you’re not a bot」，可貼上 cookies.txt 內容協助下載。</small>
                            </div>
                            <div class="cookies-field" data-cookies-field="base64" hidden>
                                <textarea id="cookiesBase64Input" class="input cookies-textarea" rows="4"
                                    placeholder="貼上 cookies.txt 的 Base64 字串（僅用於本次下載）"></textarea>
                                <small>適合在無法保留換行或需要安全傳遞時使用。</small>
                            </div>
                            <div class="cookies-field" data-cookies-field="browser" hidden>
                                <input type="text" id="cookiesFromBrowserInput" class="input"
                                    placeholder="例如：chrome、firefox、edge（需伺服器可存取瀏覽器設定檔）">
                                <small>僅適用於本機或有瀏覽器設定檔的伺服器部署。</small>
                            </div>
                        </div>
                    </details>
                    <div class="features-grid">
                        <div class="feature-item">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M9 12l2 2 4-4" />
                                <circle cx="12" cy="12" r="10" />
                            </svg>
                            <span>支援非公開影片</span>
                        </div>
                        <div class="feature-item">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                <circle cx="9" cy="7" r="4" />
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                            </svg>
                            <span>自動識別講者</span>
                        </div>
                        <div class="feature-item">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M12 2L2 7l10 5 10-5-10-5z" />
                                <path d="M2 17l10 5 10-5" />
                                <path d="M2 12l10 5 10-5" />
                            </svg>
                            <span>AI 智能修正</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 2: Progress -->
            <section class="card" id="progressSection" style="display: none;">
                <div class="card-header">
                    <div class="step-badge">處理中</div>
                    <h2>正在處理您的影片</h2>
                </div>
                <div class="card-body">
                    <!-- Overall Progress Bar -->
                    <div class="overall-progress">
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="overallProgressBar" style="width: 0%"></div>
                        </div>
                        <div class="progress-stats">
                            <span id="progressPercent">0%</span>
                            <span id="progressTime">預估時間：計算中...</span>
                        </div>
                    </div>

                    <div class="progress-container">
                        <div class="progress-step" id="step1">
                            <div class="progress-icon">
                                <div class="spinner"></div>
                                <div class="check-icon">✓</div>
                            </div>
                            <div class="progress-info">
                                <h3>下載音訊</h3>
                                <p id="step1Status">準備中...</p>
                                <div class="step-progress-bar" id="step1Bar" style="display: none;">
                                    <div class="step-progress-fill" id="step1Fill"></div>
                                </div>
                            </div>
                        </div>
                        <div class="progress-line"></div>
                        <div class="progress-step" id="step2">
                            <div class="progress-icon">
                                <div class="spinner"></div>
                                <div class="check-icon">✓</div>
                            </div>
                            <div class="progress-info">
                                <h3>語音轉文字</h3>
                                <p id="step2Status">等待中...</p>
                                <div class="step-progress-bar" id="step2Bar" style="display: none;">
                                    <div class="step-progress-fill" id="step2Fill"></div>
                                </div>
                            </div>
                        </div>
                        <div class="progress-line"></div>
                        <div class="progress-step" id="step3">
                            <div class="progress-icon">
                                <div class="spinner"></div>
                                <div class="check-icon">✓</div>
                            </div>
                            <div class="progress-info">
                                <h3>AI 智能修正</h3>
                                <p id="step3Status">等待中...</p>
                            </div>
                        </div>
                        <div class="progress-line"></div>
                        <div class="progress-step" id="step4">
                            <div class="progress-icon">
                                <div class="spinner"></div>
                                <div class="check-icon">✓</div>
                            </div>
                            <div class="progress-info">
                                <h3>生成 SRT</h3>
                                <p id="step4Status">等待中...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Cancel Button -->
                    <div class="progress-actions">
                        <button class="btn btn-secondary" id="cancelBtn">取消</button>
                    </div>
                </div>
            </section>

            <!-- Step 3: Editor -->
            <section class="card" id="editorSection" style="display: none;">
                <div class="card-header">
                    <div class="step-badge">步驟 3</div>
                    <h2>編輯逐字稿</h2>
                    <div class="card-actions">
                        <select id="editorChineseConversion" class="input conversion-select" title="繁簡轉換">
                            <option value="none">🔄 繁簡轉換</option>
                            <option value="s2t">簡體 → 繁體</option>
                            <option value="t2s">繁體 → 簡體</option>
                        </select>
                        <button class="btn btn-secondary" id="downloadSrtBtn">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10 12l-5-5h3V3h4v4h3l-5 5z" />
                                <path d="M3 17h14v-2H3v2z" />
                            </svg>
                            下載 SRT
                        </button>
                        <button class="btn btn-secondary" id="downloadTxtBtn">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10 12l-5-5h3V3h4v4h3l-5 5z" />
                                <path d="M3 17h14v-2H3v2z" />
                            </svg>
                            下載 TXT
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="editor-container">
                        <div class="editor-sidebar">
                            <div id="transcriptionInfo" class="transcription-info" style="display: none;">
                                <small>📊 模型: <span id="modelInfo">-</span></small>
                                <small>🌐 語言: <span id="languageInfo">-</span></small>
                            </div>
                            <h3>講者列表</h3>
                            <div id="speakerList" class="speaker-list"></div>

                            <!-- AI Refinement Panel -->
                            <div class="ai-refine-section">
                                <h3>🤖 AI 微調</h3>
                                <div class="refine-form">
                                    <textarea id="refinePrompt" class="input refine-input"
                                        placeholder="輸入你的指令，例如：&#10;• 把所有英文專有名詞保留原文&#10;• 修正技術術語&#10;• 把「講者 A」改成「主持人」"></textarea>
                                    <details class="context-details">
                                        <summary>進階選項</summary>
                                        <textarea id="refineContext" class="input refine-context-input"
                                            placeholder="新增影片背景資料（例如：這是一個討論 AI 的 Podcast...）"></textarea>
                                        <label class="checkbox-label" style="margin-top: 0.5rem;">
                                            <input type="checkbox" id="enableWebSearch">
                                            <span>🌍 啟用網路搜索 (Grounding)</span>
                                        </label>
                                        <small class="hint-text">讓 AI 查詢網路最新資料以校正專有名詞（僅 Gemini 可用）</small>
                                    </details>
                                    <button class="btn btn-primary refine-btn" id="refineBtn">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                            <path
                                                d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z" />
                                        </svg>
                                        執行 AI 微調
                                    </button>
                                </div>

                                <!-- Change History -->
                                <div id="changeHistory" class="change-history" style="display: none;">
                                    <div class="history-header">
                                        <h4>📝 版本歷史</h4>
                                        <span id="versionCount" class="badge">0</span>
                                    </div>
                                    <div id="versionList" class="version-list"></div>
                                    <div id="versionActions" class="version-actions" style="display: none;">
                                        <button class="btn btn-sm btn-outline" id="restoreVersionBtn">
                                            ↩️ 還原此版本
                                        </button>
                                    </div>
                                    <div id="changeDetails" class="change-details"></div>
                                </div>
                            </div>
                        </div>
                        <div class="editor-main">
                            <div id="transcriptEditor" class="transcript-editor"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Error Modal (可複製的錯誤訊息) -->
        <div class="modal" id="errorModal">
            <div class="modal-content error-modal-content">
                <div class="modal-header error-header">
                    <h2>❌ 處理過程中發生錯誤</h2>
                    <button class="close-btn" id="closeError">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="error-message-container">
                        <pre id="errorMessage" class="error-message"></pre>
                    </div>
                    <div class="error-actions">
                        <button class="btn btn-secondary" id="copyErrorBtn">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2z" />
                                <path d="M2 6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-2h-2v2H2V8h2V6H2z" />
                            </svg>
                            複製錯誤訊息
                        </button>
                        <button class="btn btn-primary" id="retryBtn">重新嘗試</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>使用 AI 技術驅動 · 支援多種 STT 服務 · 開源專案</p>
        </footer>
    </div>

    <script src="app.js"></script>
</body>

</html>
